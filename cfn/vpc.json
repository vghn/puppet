{
  "Description": "VPC CloudFormation Stack",

  "Mappings": {
    "CIDRs": {
      "us-east-1": {
        "VPC": "10.1.0.0/16",
        "Subnet1": "10.1.1.0/24",
        "Subnet2": "10.1.2.0/24",
        "Subnet3": "10.1.3.0/24",
        "Subnet4": "10.1.4.0/24"
      }
    }
  },

  "Resources": {
    "VPC": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "EnableDnsSupport": "true",
        "EnableDnsHostnames": "true",
        "CidrBlock": {"Fn::FindInMap": ["CIDRs", "us-east-1", "VPC"]}
      }
    },

    "Subnet1": {
      "Type": "AWS::EC2::Subnet",
      "DependsOn": "AttachGateway",
      "Properties": {
        "AvailabilityZone": "us-east-1b",
        "VpcId": {"Ref": "VPC" },
        "CidrBlock": {"Fn::FindInMap": ["CIDRs", "us-east-1", "Subnet1"]}
      }
    },
    "Subnet2": {
      "Type": "AWS::EC2::Subnet",
      "DependsOn": "AttachGateway",
      "Properties": {
        "AvailabilityZone": "us-east-1c",
        "VpcId": {"Ref": "VPC" },
        "CidrBlock": {"Fn::FindInMap": ["CIDRs", "us-east-1", "Subnet2"]}
      }
    },
    "Subnet3": {
      "Type": "AWS::EC2::Subnet",
      "DependsOn": "AttachGateway",
      "Properties": {
        "AvailabilityZone": "us-east-1d",
        "VpcId": {"Ref": "VPC" },
        "CidrBlock": {"Fn::FindInMap": ["CIDRs", "us-east-1", "Subnet3"]}
      }
    },
    "Subnet4": {
      "Type": "AWS::EC2::Subnet",
      "DependsOn": "AttachGateway",
      "Properties": {
        "AvailabilityZone": "us-east-1e",
        "VpcId": {"Ref": "VPC" },
        "CidrBlock": {"Fn::FindInMap": ["CIDRs", "us-east-1", "Subnet4"]}
      }
    },

    "InternetGateway": {
      "Type": "AWS::EC2::InternetGateway"
    },
    "AttachGateway": {
       "Type": "AWS::EC2::VPCGatewayAttachment",
       "Properties": {
         "VpcId": {"Ref": "VPC"},
         "InternetGatewayId": {"Ref": "InternetGateway"}
       }
    },

    "RouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {"Ref": "VPC"}
      }
    },
    "Route": {
      "Type": "AWS::EC2::Route",
      "DependsOn": "AttachGateway",
      "Properties": {
        "RouteTableId": {"Ref": "RouteTable"},
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {"Ref": "InternetGateway"}
      }
    },
    "Subnet1RouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet1"},
        "RouteTableId": {"Ref": "RouteTable"}
      }
    },
    "Subnet2RouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet2"},
        "RouteTableId": {"Ref": "RouteTable"}
      }
    },
    "Subnet3RouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet3"},
        "RouteTableId": {"Ref": "RouteTable"}
      }
    },
    "Subnet4RouteTableAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet4"},
        "RouteTableId": {"Ref": "RouteTable"}
      }
    },

    "NetworkAcl": {
      "Type": "AWS::EC2::NetworkAcl",
      "Properties": {
        "VpcId": {"Ref": "VPC"}
      }
    },
    "Subnet1NetworkAclAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet1"},
        "NetworkAclId": {"Ref": "NetworkAcl"}
      }
    },
    "Subnet2NetworkAclAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet2"},
        "NetworkAclId": {"Ref": "NetworkAcl"}
      }
    },
    "Subnet3NetworkAclAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet3"},
        "NetworkAclId": {"Ref": "NetworkAcl"}
      }
    },
    "Subnet4NetworkAclAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {"Ref": "Subnet4"},
        "NetworkAclId": {"Ref": "NetworkAcl"}
      }
    },

    "InBoundAllTrafficNetworkAclEntry": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {"Ref": "NetworkAcl"},
        "RuleNumber": "100",
        "Protocol": "-1",
        "RuleAction": "allow",
        "Egress": "false",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "OutBoundAllTrafficNetworkAclEntry": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {"Ref": "NetworkAcl"},
        "RuleNumber": "100",
        "Protocol": "-1",
        "RuleAction": "allow",
        "Egress": "true",
        "CidrBlock": "0.0.0.0/0"
      }
    }
  },

  "Outputs": {
    "VPCId": { "Description": "VPC ID", "Value": {"Ref": "VPC"} },
    "Subnet1": { "Description": "Subnet1 ID", "Value": {"Ref": "Subnet1"} },
    "Subnet2": { "Description": "Subnet2 ID", "Value": {"Ref": "Subnet2"} },
    "Subnet3": { "Description": "Subnet3 ID", "Value": {"Ref": "Subnet3"} },
    "Subnet4": { "Description": "Subnet4 ID", "Value": {"Ref": "Subnet4"} }
  }

}
